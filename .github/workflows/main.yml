# â˜ï¸ Ø«Ù‚Ù Ù†ÙØ³Ùƒ - GitHub Actions Version
import google.generativeai as genai
import gspread
from datetime import datetime
import os

# Configuration - API key from environment
GOOGLE_API_KEY = os.environ.get('GOOGLE_API_KEY', 'AIzaSyDf1H1PB5RWzQOFO_4n_O8qGfHFyYwBc50')
SHEET_ID = "1e70e5BvNuQFQtipB-7hYY6U1eUn4_OkLCn0-PG3BHM8"

def main():
    """Main function for GitHub Actions"""
    print("ğŸš€ Starting Ø«Ù‚Ù Ù†ÙØ³Ùƒ on GitHub Actions...")
    
    try:
        # Configure AI
        genai.configure(api_key=GOOGLE_API_KEY)
        model = genai.GenerativeModel('models/gemini-2.0-flash')
        
        # Our perfected prompt
        prompt = """
        You are "Ø«Ù‚Ù Ù†ÙØ³Ùƒ" (Educate Yourself), a multilingual AI news content generator.
        ONLY select Artificial Intelligence (AI) news from the last 48 hours.

        Output the email in THREE languages: Arabic, French, and English. Use this exact structure:

        Subject: [English AI News Title]

        ğŸŒ MULTILINGUAL CONTENT PACKAGE

        Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)
        ğŸ“· Ø¥Ù†Ø³ØªØºØ±Ø§Ù…: [Arabic Instagram script]
        ğŸ’¼ Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù†: [Arabic LinkedIn post]  
        ğŸ¦ ğ• (ØªÙˆÙŠØªØ±): [Arabic X thread]
        ğŸ“˜ ÙÙŠØ³Ø¨ÙˆÙƒ: [Arabic Facebook post]

        FranÃ§ais (French)
        ğŸ“· Instagram: [French Instagram script]
        ğŸ’¼ LinkedIn: [French LinkedIn post]
        ğŸ¦ X: [French X thread]
        ğŸ“˜ Facebook: [French Facebook post]

        English  
        ğŸ“· Instagram: [English Instagram script]
        ğŸ’¼ LinkedIn: [English LinkedIn post]
        ğŸ¦ X: [English X thread]
        ğŸ“˜ Facebook: [English Facebook post]

        ğŸ”— Ø§Ù„Ù…ØµØ¯Ø±/Source/Source: [URL] - Ø§Ù„Ù†Ø´Ø±/Published/PubliÃ©: [Date]
        ğŸ–¼ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„ØµÙˆØ±Ø©/Image Keyword/Mot-clÃ© image: [Keyword]
        """
        
        print("ğŸ¤– Generating AI news...")
        response = model.generate_content(prompt)
        
        # Extract news title
        news_title = "Unknown Title"
        if "Subject:" in response.text:
            news_title = response.text.split("Subject:")[1].split("\n")[0].strip()
        
        print(f"ğŸ“° News generated: {news_title}")
        
        # Log to Google Sheets
        log_to_sheets(news_title, response.text[:100])
        
        print("âœ… GitHub Actions automation completed!")
        return True
        
    except Exception as e:
        print(f"âŒ Error: {e}")
        return False

def log_to_sheets(news_title, content_preview):
    """Log to Google Sheets"""
    try:
        # For GitHub Actions, we need service account auth
        # For now, let's just print success
        print(f"ğŸ“Š Would log to Google Sheets: {news_title}")
        print("ğŸ’¡ Enable service account auth for full automation")
        return True
        
    except Exception as e:
        print(f"âŒ Sheets logging error: {e}")
        return False

if __name__ == "__main__":
    success = main()
    exit(0 if success else 1)
